# ca-assets
Assets for Cognos Analytics project

This requires and runs on IBM Cloud Pak for Data, and the following services:

* Watson Discovery
* Db2 Warehouse

## Scripts

To run each of the following scripts:

1. Clone the repo

```bash
git clone https://github.com/rhagarty/ca-assets.git
```

1. Run the script, for example:

```bash
cd ca-assets/scripts
node csv-find-product-with-most-reviews
```

### csv-find-product-with-most-reviews.js

1. Download Amazon food review data from [Kaggle](https://www.kaggle.com/snap/amazon-fine-food-reviews).
1. Save as local file `data/Reviews-full.csv`.
1. Process all reviews and log the number of reviews per product, along with how useful each review is based on `helpfullness factor`.
1. Print out the list of products in order of useful reviews.

### csv-to-json.js

1. Use the top 10 reviews determined by `csv-find-product-with-most-reviews`.
1. Cut and paste product ID of the top 10 products.
1. Add a more user-readable product ID for each.
1. Process all reviews in `data/Reviews-full.csv`, and only process the top 100 useful reviews for the products we have identified.
1. Create a json file for each review and store it in the `data/food_reviews` directory.

Once complete, upload the json files into Watson Discovery for processing.

### store-disco-enrichments.js

1. Connect to the Watson Discovery collection containing our processed reviews.
1. Connect to an instance of Db2 Warehouse.
1. Process each of the results from Discovery.
1. For each result, add it to the csv file `data/out.csv`.
1. For each result, add it to our Db2 Warehouse table.

Notes:

* Connection info for both Discovery and Db2 Warehouse must be stored locally in the `.env` file, using the format specified in `env.sample`.

* The actual review dates were spread out from 2008-20017. In order to make the data more relevant to our needs, we modified all dates to be in 2019.

### create-sales-data.js

The purpose of this script is to generate fake data to support our project. The fake data is written out to both csv files and to our Db2 Warehouse table.

* `data/out-stores.csv` - this is information about each of our stores. Includes store_id and location.

* `data/out-warehouses.csv` - this is information about each of our warehouses, which are used to supply our stores with product. Includes warehouse_id, the amout of each product, and the amount of product that comes in on a monthly basis.

* `data/out-sales.csv` - this is the sales data from each of the stores. Includes store_id, product_id, data, and amount of items sold.

* `data/out-orders.csv` - this is orders generated by our stores. Includes store_id, product_id, date, and number of items.

Flow:

* Stores have sales (`out-sales`)
* Stores make orders to handle demand of product (create `out-orders`)
* Warehouse supply stores with product (fulfill `out-orders`)
* Company must stock enough product in warehouses to handle demand
